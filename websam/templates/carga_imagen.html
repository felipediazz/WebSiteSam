{% extends 'base.html' %}

{% block content %}

{% load static %}
<h1>Carga de imagen</h1>
<form id="form-imagen" method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="file" name="imagen">
    <br>
    <button type="submit">Cargar imagen</button>
</form>
<!-- Segmentación Simple-->
<form method="post" action="{% url 'segmentar_imagen' %}">
    {% csrf_token %}
    <button type="submit" style="display: none;">segmentar output simple</button>
</form>
<!--  Segmentación Simple-->

<!-- Segmentación Binaria-->
<form method="post" action="{% url 'segmentar_binario' %}">
    {% csrf_token %}
    <button type="submit">segmentar con output binario CSV</button>
</form>
<!--  Segmentación Binaria-->

<!-- Segmentación JSON-->
<form method="post" action="{% url 'segmentar_json' %}">
    {% csrf_token %}
    <button type="submit">segmentar con output coco_rle JSON</button>
</form>
<!--  Segmentación JSON-->

<!--  Mostrar CSV-->
<a href="{% url 'csv-view' %}" target="_blank" class="csv-button">Descargar Output binario CSV</a>
<!--  Mostrar CSV-->

<!--  Mostrar JSON-->
<a href="{% url 'vista_json' %}" target="_blank" class="csv-button">Mostrar output coco_rle JSON</a>
<!--  Mostrar JSON-->

<!-- Mostrar Imagenes-->
<form method="post" action="{% url 'ver_imagen_segmentada' %}">
    {% csrf_token %}
    <!-- <button type="submit">Mostrar imagen segmentada</button> -->
    <input type="submit" value="Mostrar imagenes">
</form>

{% if img_original %}
<p>Imagen original</p>
<img src="{{ img_original }}" alt="Imagen Original">
{% endif %}

{% if img_segmentada %}
<p>Imagen segmentada</p>
<img src="{{ img_segmentada }}" alt="Imagen Segmentada">
{% endif %}
<!-- Mostrar Imagenes-->

<p id="mensaje"></p>

<script>
    const form = document.querySelector('#form-imagen'); //se captura para usarlo con el listener
    const mensaje = document.querySelector('#mensaje');
    form.addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(form); //objeto para ordenar los datos del formulario
        fetch('', {   // se envia los datos en metodo POST 
            method: 'POST',
            body: formData // se envia los datos del formData en body de la solicitud POST
        })
        .then(function(response) { //control de errores
            if (response.ok) {
                mensaje.innerHTML = 'Imagen cargada correctamente';
            } else {
                mensaje.innerHTML = 'Error al cargar la imagen';
            }
        })
        .catch(function(error) {
            mensaje.innerHTML = 'Error de red';
        });
    });

    //Temporal

</script>

{% endblock %}
